<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="VcsDirectoryMappings">
    <mapping directory="$PROJECT_DIR$" vcs="Git" />
  </component>
</project>

package com.imobile3.pos.data.module.batch.report

import com.imobile3.pos.app.AppLocaleHelper
import com.imobile3.pos.app.extensions.formatForDisplay
import com.imobile3.pos.app.extensions.isZero
import com.imobile3.pos.app.extensions.orZeroIfNull
import com.imobile3.pos.data.module.order.rules.MathRules
import com.imobile3.pos.library.domainobjects.BatchReportDetailed
import com.imobile3.pos.library.utils.CartTaxHelper
import com.imobile3.pos.library.utils.CurrencyManager
import com.imobile3.pos.library.utils.FormatHelper
import java.math.BigDecimal

object BatchReportsHelper {

    /**
     * % of Sales = Non-Cash Tips / Sales
     */
    @JvmStatic
    fun calculateTotalPercentageSales(report: BatchReportDetailed): String? =
            if (report.grandTotal == null || report.grandTotal?.isZero() == true) {
                CartTaxHelper.getFormattedTaxRate(BigDecimal.ZERO, true)
            } else {
                FormatHelper.formatPercentage(
                        report.tipTotal.orZeroIfNull().divide(
                                report.grandTotal,
                                getCurrencyManager().maxCalculationPrecision,
                                getCurrencyManager().roundingStyle))
            }

    /**
     * Total Sales
     */
    @JvmStatic
    fun calculateTotalSales(report: BatchReportDetailed): String =
            MathRules.zeroIfNull(report.grandTotal).formatForDisplay(showSymbol = false)

    /**
     * Non-Cash Tips
     */
    @JvmStatic
    fun calculateNonCashTips(report: BatchReportDetailed): String =
            MathRules.zeroIfNull(report.tipTotal).formatForDisplay(showSymbol = false)

    private fun getCurrencyManager(): CurrencyManager = AppLocaleHelper.getCurrencyManager()
}
